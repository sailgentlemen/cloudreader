(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/read/read"],{"09eb":function(t,e,n){"use strict";var o=n("d2c4"),r=n.n(o);r.a},"468f":function(t,e,n){"use strict";var o={Setting:function(){return n.e("components/Setting/Setting").then(n.bind(null,"dcbc"))}},r=function(){var t=this,e=t.$createElement,n=(t._self._c,{position:"absolute",bottom:"0",width:"100%"}),o={position:"absolute",bottom:"40vh",right:"10rpx"};t.$mp.data=Object.assign({},{$root:{a0:n,a1:o}})},s=[];n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o}))},"4c6d":function(t,e,n){"use strict";n.r(e);var o=n("468f"),r=n("d40b");for(var s in r)"default"!==s&&function(t){n.d(e,t,(function(){return r[t]}))}(s);n("09eb");var i,c=n("f0c5"),a=Object(c["a"])(r["default"],o["b"],o["c"],!1,null,"1e3db31c",null,!1,o["a"],i);e["default"]=a.exports},"7d62":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(n("4795")),r=s(n("2ef0"));function s(t){return t&&t.__esModule?t:{default:t}}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e,n,o,r,s,i){try{var c=t[s](i),a=c.value}catch(u){return void n(u)}c.done?e(a):Promise.resolve(a).then(o,r)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(o,r){var s=t.apply(e,n);function i(t){u(s,o,r,i,c,"next",t)}function c(t){u(s,o,r,i,c,"throw",t)}i(void 0)}))}}var f={data:function(){return{rerender:!0,grade_value:0,contents:[],count:0,finished:!1,joinInTheBookcases:!1,_id:"",content:null,skip:0,book:"",val:0,isBottom:!1,enableScroll:!1,oldScrollTop:0,limitDistance:50,scrollTop:0,old:{scrollTop:0},refreshScrollTop:0}},computed:{socre:function(){if(this.$store.state.commentList.length){var t=this.$store.state.commentList.reduce((function(t,e){return+e.value+t}),0);return(2*t/this.$store.state.commentList.length).toFixed(1)}return 0},commentList:function(){return this.$store.state.commentList},publish_success:function(){return this.$store.state.publish_success},comments:function(){return this.commentList.slice(0,1)},isComment:function(){return"轻点评分"},isDark:function(){return"dark"===this.$store.state.theme},decline:function(){return this.$store.state.decline},theme:function(){return this.$store.state.theme},showCatalog:function(){return this.$store.state.showCatalog},showSetting:function(){return this.$store.state.showSettings},hideBookInfo:function(){return 0!==this.skip}},created:function(){this.scrollHanlde=r.default.throttle(this.pageOnScroll,30)},methods:{gradeHandle:function(t){var e=t.value;this.grade_value=e,this.gotoComment(e)},sortHandle:function(){this.contents=this.contents.reverse()},addRecords:function(t){var e=this;return l(o.default.mark((function n(){var r,s,i,c;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.joinInTheBookcases=t,r=e.$store.state.userInfo.bookrack.find((function(t){return t._id===e._id})),!r){n.next=12;break}if(s=r.records,i=s.skip,c=s.scrollTop,0!==i){n.next=10;break}return n.next=7,e.getContent();case 7:e.scrollTop=c,n.next=12;break;case 10:e.skip=i,e.refreshScrollTop=c;case 12:case"end":return n.stop()}}),n)})))()},getUserInfo:function(){var t=this;return l(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("userInfo");case 2:case"end":return e.stop()}}),e)})))()},skipHandle:function(t){var e=this;return l(o.default.mark((function n(){var r,s;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.refreshScrollTop=0,r=t.index,s=t.isOver,e.finished=s,e.skip=r;case 4:case"end":return n.stop()}}),n)})))()},nextHandle:function(){var t=this;return l(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.skip!==t.count-1){e.next=2;break}return e.abrupt("return");case 2:t.refreshScrollTop=0,t.skip+=1;case 4:case"end":return e.stop()}}),e)})))()},previousHandle:function(){var t=this;return l(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.skip){e.next=2;break}return e.abrupt("return");case 2:t.refreshScrollTop=0,t.skip-=1;case 4:case"end":return e.stop()}}),e)})))()},goTopHandle:function(){var t=this;this.play=!0,this.scrollTop=this.old.scrollTop,this.$nextTick((function(){t.scrollTop=0,t.$store.commit("showSettings",!1)}))},getContent:function(e){var n=this;return l(o.default.mark((function e(){var r,s;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.showLoading({title:"加载中..."}),r=n.book.contents[n.skip],e.next=4,wx.cloud.callFunction({name:"getContent",data:c({},r)});case 4:s=e.sent,t.hideLoading(),n.content=s.result;case 7:case"end":return e.stop()}}),e)})))()},gotoComment:function(e){this.$store.state.userInfo||t.navigateTo({url:"/pages/login/login"}),e&&(this.val=e,t.navigateTo({url:"/pages/comment/comment?val="+e+"&_id="+this.book._id+"&name="+encodeURIComponent(this.book.bookName)}))},tapHandle:function(){this.$store.commit("showSettings",!this.showSetting)},rollbackHandle:function(t){this.scroll=t,this.$store.commit("showSettings",!1)},catalogHandle:function(t){this.enableScroll=t},pageOnEarth:function(){this.$store.commit("showSettings",!0),this.isBottom=!0},pageOnScroll:function(t){this.old.scrollTop=t.detail.scrollTop,this.isBottom&&this.showSetting?this.oldScrollTop-t.detail.scrollTop>this.limitDistance&&(this.$store.commit("showSettings",!1),this.isBottom=!1):(this.isBottom=!1,this.$store.commit("showSettings",!1),this.oldScrollTop=t.detail.scrollTop)},addBookRecords:function(){wx.cloud.callFunction({name:"addBookRecords",data:{_id:this._id,skip:this.skip,scrollTop:this.old.scrollTop}})},getBook:function(t){return l(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,wx.cloud.callFunction({name:"getBook",data:{_id:t}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},checkUserComment:function(){var t=this;return l(o.default.mark((function e(){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,wx.cloud.callFunction({name:"checkComment",data:{_id:t.book._id}});case 2:n=e.sent,n.result.list[0]&&n.result.list[0].comments.length?(t.grade_value=n.result.list[0].comments[0].value,t.$store.commit("PUBLISH_SUCCESS",!0),t.rerender=!1,t.$nextTick((function(){t.rerender=!0}))):t.$store.commit("PUBLISH_SUCCESS",!1);case 4:case"end":return e.stop()}}),e)})))()},getComments:function(){var t=this;return l(o.default.mark((function e(){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={_id:t.book._id},e.next=3,t.$store.dispatch("GETCOMMENTS",n);case 3:case"end":return e.stop()}}),e)})))()}},watch:{book:function(t){var e=this;return l(o.default.mark((function n(){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.getComments();case 2:return n.next=4,e.checkUserComment();case 4:e.count=t.contents.length,e.contents=e.book.contents.slice();case 6:case"end":return n.stop()}}),n)})))()},showSetting:function(t){t||(this.$store.commit("showCatalog",!1),this.$store.commit("showConfigs",!1))},skip:function(){var t=this;return l(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.commit("showSettings",!1),e.next=3,t.getContent();case 3:t.skip===t.count-1?t.finished=!0:t.finished=!1,0===t.refreshScrollTop?t.goTopHandle():t.scrollTop=t.refreshScrollTop;case 5:case"end":return e.stop()}}),e)})))()}},onShareAppMessage:function(){return{title:"分享一本好书《".concat(this.book.bookName,"》,快来和我一起看看"),path:"/pages/read/read?_id=".concat(this.book._id),imageUrl:this.book.cover,desc:"快来跟我一起看小说",success:function(){t.showToast({title:"分享成功"})},fail:function(t){console.log("分享失败",t)}}},onLoad:function(){var e=l(o.default.mark((function e(n){var r,s;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return"dark"===this.$store.state.theme&&t.setNavigationBarColor({frontColor:"#ffffff",backgroundColor:"#000000",success:function(t){console.log(t)},fail:function(t){console.log(t)}}),t.showLoading({title:"加载中..."}),this._id=n._id,e.next=5,this.getBook(n._id);case 5:return r=e.sent,r.result.data&&(s=r.result.data,this.book=s),e.next=9,this.getUserInfo();case 9:if(!this.$store.state.userInfo){e.next=15;break}if(this.$store.state.userInfo.bookrack.find((function(t){return t._id===n._id}))){e.next=13;break}return e.next=13,this.getContent();case 13:e.next=17;break;case 15:return e.next=17,this.getContent();case 17:case"end":return e.stop()}}),e,this)})));function n(t){return e.apply(this,arguments)}return n}(),onReachBottom:function(){},onPageScroll:function(t){},onHide:function(){},onUnload:function(){this.$store.commit("PUBLISH_SUCCESS",!1),this.$store.commit("GETCOMMENTS",{result:{data:[]}});var e=this;!this.joinInTheBookcases&&this.skip>2&&!this.decline?t.navigateTo({url:"/pages/read/read?_id="+this._id,success:function(){t.showModal({title:"加入书桌？",content:"添加到书桌，下次看书更方便",cancelText:"狠心拒绝",confirmText:"加入书桌",confirmColor:"#FC6337",success:function(t){t.cancel&&e.$store.commit("SETDECLINE",!0),t.confirm&&e.$store.commit("SETAGREE",!0)},fail:function(t){console.log("fail",t)}})}}):(this.$store.commit("SETDECLINE",!1),this.$store.commit("SETAGREE",!1)),this.$store.state.showSettings&&this.$store.commit("showSettings",!1),this.$store.state.userInfo&&this.joinInTheBookcases&&this.addBookRecords()}};e.default=f}).call(this,n("543d")["default"])},cc26:function(t,e,n){"use strict";(function(t){n("ac90"),n("921b");o(n("66fd"));var e=o(n("4c6d"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},d2c4:function(t,e,n){},d40b:function(t,e,n){"use strict";n.r(e);var o=n("7d62"),r=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=r.a}},[["cc26","common/runtime","common/vendor"]]]);